-- Create the database and select it
CREATE DATABASE IF NOT EXISTS LibraryDB;
USE LibraryDB;

-- Drop tables if they exist (order matters because of foreign key dependencies)
DROP TABLE IF EXISTS BOOK_LENDING;
DROP TABLE IF EXISTS BOOK_COPIES;
DROP TABLE IF EXISTS BOOK_AUTHORS;
DROP TABLE IF EXISTS BOOK;
DROP TABLE IF EXISTS CARD;
DROP TABLE IF EXISTS LIBRARY_BRANCH;
DROP TABLE IF EXISTS PUBLISHER;

-- Create PUBLISHER table
CREATE TABLE PUBLISHER (
    NAME VARCHAR(20) PRIMARY KEY,
    PHONE VARCHAR(15),
    ADDRESS VARCHAR(20)
);

-- Create BOOK table
CREATE TABLE BOOK (
    BOOK_ID INT PRIMARY KEY,
    TITLE VARCHAR(20),
    PUB_YEAR VARCHAR(20),
    PUBLISHER_NAME VARCHAR(100),
    FOREIGN KEY (PUBLISHER_NAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE
);

-- Create BOOK_AUTHORS table
CREATE TABLE BOOK_AUTHORS (
    AUTHOR_NAME VARCHAR(20),
    BOOK_ID INT,
    PRIMARY KEY (BOOK_ID, AUTHOR_NAME),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE
);

-- Create LIBRARY_BRANCH table
CREATE TABLE LIBRARY_BRANCH (
    BRANCH_ID INT PRIMARY KEY,
    BRANCH_NAME VARCHAR(50),
    ADDRESS VARCHAR(50)
);

-- Create BOOK_COPIES table
CREATE TABLE BOOK_COPIES (
    BOOK_ID INT,
    BRANCH_ID INT,
    NO_OF_COPIES INT,
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
    PRIMARY KEY (BOOK_ID, BRANCH_ID)
);

-- Create CARD table
CREATE TABLE CARD (
    CARD_NO INT PRIMARY KEY
);

-- Create BOOK_LENDING table
CREATE TABLE BOOK_LENDING (
    BOOK_ID INT,
    BRANCH_ID INT,
    CARD_NO INT,
    DATE_OUT DATE,
    DUE_DATE DATE,
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
    FOREIGN KEY (CARD_NO) REFERENCES CARD(CARD_NO) ON DELETE CASCADE,
    PRIMARY KEY (BOOK_ID, BRANCH_ID, CARD_NO)
);

-- Inserting data

-- INSERT INTO PUBLISHER
INSERT INTO PUBLISHER VALUES ('MCGRAW-HILL', '9989076587', 'BANGALORE');
INSERT INTO PUBLISHER VALUES ('PEARSON', '9889076565', 'NEW DELHI');
INSERT INTO PUBLISHER VALUES ('RANDOM HOUSE', '7455679345', 'HYDERABAD');
INSERT INTO PUBLISHER VALUES ('HACHETTE LIVRE', '8970862340', 'CHENNAI');
INSERT INTO PUBLISHER VALUES ('GRUPO PLANETA', '7756120238', 'BANGALORE');

-- INSERT INTO BOOK
INSERT INTO BOOK VALUES (1, 'DBMS', 'JAN-2017', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES (2, 'ADBMS', 'JUN-2016', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES (3, 'CN', 'SEP-2016', 'PEARSON');
INSERT INTO BOOK VALUES (4, 'CG', 'SEP-2015', 'GRUPO PLANETA');
INSERT INTO BOOK VALUES (5, 'OS', 'MAY-2016', 'PEARSON');

-- INSERT INTO BOOK_AUTHORS
INSERT INTO BOOK_AUTHORS VALUES ('NAVATHE', 1);
INSERT INTO BOOK_AUTHORS VALUES ('NAVATHE', 2);
INSERT INTO BOOK_AUTHORS VALUES ('TANENBAUM', 3);
INSERT INTO BOOK_AUTHORS VALUES ('EDWARD ANGEL', 4);
INSERT INTO BOOK_AUTHORS VALUES ('GALVIN', 5);

-- INSERT INTO LIBRARY_BRANCH
INSERT INTO LIBRARY_BRANCH VALUES (10, 'RR NAGAR', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH VALUES (11, 'RNSIT', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH VALUES (12, 'RAJAJI NAGAR', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH VALUES (13, 'NITTE', 'MANGALORE');
INSERT INTO LIBRARY_BRANCH VALUES (14, 'MANIPAL', 'UDUPI');

-- INSERT INTO BOOK_COPIES
INSERT INTO BOOK_COPIES VALUES (1, 11, 5);
INSERT INTO BOOK_COPIES VALUES (2, 12, 2);
INSERT INTO BOOK_COPIES VALUES (2, 13, 5);
INSERT INTO BOOK_COPIES VALUES (3, 14, 7);
INSERT INTO BOOK_COPIES VALUES (5, 10, 1);
INSERT INTO BOOK_COPIES VALUES (4, 11, 3);

-- INSERT INTO CARD
INSERT INTO CARD VALUES (100);
INSERT INTO CARD VALUES (101);
INSERT INTO CARD VALUES (102);
INSERT INTO CARD VALUES (103);
INSERT INTO CARD VALUES (104);

-- INSERT INTO BOOK_LENDING
INSERT INTO BOOK_LENDING VALUES (1, 10, 101, '2017-01-01', '2017-06-01');
INSERT INTO BOOK_LENDING VALUES (3, 14, 101, '2017-01-11', '2017-03-11');
INSERT INTO BOOK_LENDING VALUES (2, 13, 101, '2017-02-21', '2017-04-21');
INSERT INTO BOOK_LENDING VALUES (4, 11, 101, '2017-03-15', '2017-07-15');
INSERT INTO BOOK_LENDING VALUES (1, 11, 104, '2017-04-12', '2017-05-12');

Q1:
SELECT
B.BOOK_ID,B.TITLE,B.PUBLISHER_NAME,A.AUTHOR_NAME,C.NO_OF_COPIES,L.BRANCH_ID
FROM BOOK B,BOOK_AUTHORS A, BOOK_COPIES C,LIBRARY_BRANCH L
WHERE B.BOOK_ID=A.BOOK_ID
AND B.BOOK_ID=C.BOOK_ID
AND C.BRANCH_ID= L.BRANCH_ID
Q2:
SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017-07-01'
GROUP BY CARD_NO
HAVING COUNT(*) > 3;
Q3: DELETE FROM BOOK WHERE BOOK_ID=3;
Q4:CREATE VIEW V_PUBLICATION AS SELECT PUB_YEAR FROM BOOK;
Q5:
CREATE VIEW V_BOOKS AS SELECT
B.BOOK_ID,B.TITLE,C.NO_OF_COPIES FROM BOOK B, BOOK_COPIES C, LIBRARY_BRANCH
L
WHERE B.BOOK_ID=C.BOOK_ID
AND L.BRANCH_ID=C.BRANCH_ID;