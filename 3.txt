-- Movie Database Script

CREATE DATABASE MOVIEDB;
USE MOVIEDB;

DROP TABLE IF EXISTS RATING;
DROP TABLE IF EXISTS MOVIE_CAST;
DROP TABLE IF EXISTS MOVIES;
DROP TABLE IF EXISTS DIRECTOR;
DROP TABLE IF EXISTS ACTOR;

CREATE TABLE ACTOR(
    ACT_ID INT PRIMARY KEY,
    ACT_NAME VARCHAR(50),
    ACT_GENDER CHAR
);

CREATE TABLE DIRECTOR(
    DIR_ID INT PRIMARY KEY,
    DIR_NAME VARCHAR(50),
    DIR_PHONE VARCHAR(20)
);

CREATE TABLE MOVIES(
    MOV_ID INT PRIMARY KEY,
    MOV_TITLE VARCHAR(50),
    MOV_YEAR INT,
    MOV_LANG VARCHAR(20),
    DIR_ID INT,
    FOREIGN KEY(DIR_ID) REFERENCES DIRECTOR(DIR_ID) ON DELETE CASCADE
);

CREATE TABLE MOVIE_CAST(
    ACT_ID INT,
    MOV_ID INT,
    ROLE VARCHAR(50),
    PRIMARY KEY(ACT_ID, MOV_ID),
    FOREIGN KEY(ACT_ID) REFERENCES ACTOR(ACT_ID) ON DELETE CASCADE,
    FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID) ON DELETE CASCADE
);

CREATE TABLE RATING(
    MOV_ID INT PRIMARY KEY,
    REV_STARS INT,
    FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID) ON DELETE CASCADE
);

INSERT INTO ACTOR VALUES (1, 'A', 'M');
INSERT INTO ACTOR VALUES (2, 'B', 'F');
INSERT INTO ACTOR VALUES (3, 'C', 'M');
INSERT INTO ACTOR VALUES (4, 'D', 'F');

INSERT INTO DIRECTOR VALUES (1, 'ABCD', '1111');
INSERT INTO DIRECTOR VALUES (2, 'XYZ', '2222');
INSERT INTO DIRECTOR VALUES (3, 'PQR', '3333');
INSERT INTO DIRECTOR VALUES (4, 'MNO', '4444');

INSERT INTO MOVIES VALUES (1, 'Movie1', 1995, 'English', 1);
INSERT INTO MOVIES VALUES (2, 'Movie2', 2018, 'Hindi', 1);
INSERT INTO MOVIES VALUES (3, 'Movie3', 2005, 'Telugu', 2);
INSERT INTO MOVIES VALUES (4, 'Movie4', 2020, 'English', 2);

INSERT INTO MOVIE_CAST VALUES (1, 1, 'Hero');
INSERT INTO MOVIE_CAST VALUES (1, 2, 'Villain');
INSERT INTO MOVIE_CAST VALUES (2, 2, 'Heroine');
INSERT INTO MOVIE_CAST VALUES (3, 3, 'Hero');
INSERT INTO MOVIE_CAST VALUES (3, 4, 'Guest');

INSERT INTO RATING VALUES (1, 3);
INSERT INTO RATING VALUES (2, 4);
INSERT INTO RATING VALUES (3, 2);
INSERT INTO RATING VALUES (4, 5);

-- Query 1
SELECT MOV_TITLE
FROM MOVIES
WHERE DIR_ID = (SELECT DIR_ID FROM DIRECTOR WHERE DIR_NAME = 'ABCD');

-- Query 2
SELECT DISTINCT M.MOV_TITLE
FROM MOVIES M
JOIN MOVIE_CAST MC ON M.MOV_ID = MC.MOV_ID
WHERE MC.ACT_ID IN (
    SELECT ACT_ID
    FROM MOVIE_CAST
    GROUP BY ACT_ID
    HAVING COUNT(DISTINCT MOV_ID) >= 2
);

-- Query 3
SELECT A.ACT_NAME
FROM ACTOR A
JOIN MOVIE_CAST MC1 ON A.ACT_ID = MC1.ACT_ID
JOIN MOVIES M1 ON MC1.MOV_ID = M1.MOV_ID AND M1.MOV_YEAR < 2000
JOIN MOVIE_CAST MC2 ON A.ACT_ID = MC2.ACT_ID
JOIN MOVIES M2 ON MC2.MOV_ID = M2.MOV_ID AND M2.MOV_YEAR > 2015;

-- Query 4
SELECT M.MOV_TITLE, MAX(R.REV_STARS) AS MAX_STARS
FROM MOVIES AS M
JOIN RATING AS R USING (MOV_ID)
WHERE R.REV_STARS > 0
GROUP BY M.MOV_TITLE
ORDER BY M.MOV_TITLE;

-- Query 5
UPDATE RATING AS R
JOIN MOVIES AS M ON R.MOV_ID = M.MOV_ID
JOIN DIRECTOR AS D ON M.DIR_ID = D.DIR_ID
SET R.REV_STARS = 5
WHERE D.DIR_NAME = 'XYZ';